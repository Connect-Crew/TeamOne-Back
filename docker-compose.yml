version: "3.7"

services:
  composite:
    container_name: teamone-composite
    build: microservices/composite-service

    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - TZ=Asia/Seoul

    volumes:
      - ${ROOT_PATH}/banner:/resources/banner

    ports:
      - "9080:8080"

  user:
    container_name: teamone-user
    build: microservices/user-service

    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - TZ=Asia/Seoul
      - DB_PW=${DB_PASSWORD}

  project:
    container_name: teamone-project
    build: microservices/project-service

    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - TZ=Asia/Seoul
      - DB_PW=${DB_PASSWORD}

  user-mysql:
    container_name: teamone-user-mysql
    image: mysql:8.0

    ports:
      - "4306:3306"

    volumes:
      - ${ROOT_PATH}/user:/var/lib/mysql

    environment:
      MYSQL_ROOT_PASSWORD: ${DB_PASSWORD}

      MYSQL_CHARSET: utf8mb4
      MYSQL_COLLATION: utf8mb4_unicode_ci

  project-mysql:
    container_name: teamone-project-mysql
    image: mysql:8.0

    ports:
      - "4305:3306"

    volumes:
      - ${ROOT_PATH}/project:/var/lib/mysql

    environment:
      MYSQL_ROOT_PASSWORD: ${DB_PASSWORD}

      MYSQL_CHARSET: utf8mb4
      MYSQL_COLLATION: utf8mb4_unicode_ci

  redis:
    container_name: teamone-redis
    image: redis:latest
    ports:
      - "4379:6379"

    volumes:
      - ${ROOT_PATH}/Redis:/data